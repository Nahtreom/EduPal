<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDUPAL</title>
    <!-- <link rel="icon" type="image/png" href="{{ url_for('static', filename='template_images/EDUPAL_logo.png') }}"> -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='template_images/EDUPAL_logo.png') }}?v=2">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* è¿›ä¸€æ­¥ç¼©å°æ­¥éª¤æ¡†çš„å¤§å° */
        .step-item {
            padding: 0.5px;
            margin: 0.25px;
            border-radius: 0.5px;
            background-color: #c0c0c0;
            display: flex;
            align-items: center;
        }
        .step-icon {
            font-size: 10px;
            margin-right: 2px;
        }
        .step-text {
            font-size: 6px;
        }
        .group-toggle span {
            font-size: 8px;
            transition: transform 0.2s ease;
        }
        .group-toggle span:hover {
            transform: scale(1.2);
        }
        
        /* æ§åˆ¶é¡µé¢å®½åº¦ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .steps-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            max-width: 100%;
            overflow: hidden;
        }
        
        .overall-progress {
            margin: 10px 0;
        }
        
        .upload-success-actions {
            max-width: 100%;
            padding: 15px;
        }
        
        /* å®æ—¶æ—¥å¿—æ ·å¼è°ƒæ•´ */
        .log-content {
            text-align: left;
            padding: 10px;
        }
        
        .log-item {
            text-align: left;
            margin: 2px 0;
        }
        
        .log-message {
            text-align: left;
        }
        
        /* æ™ºèƒ½ä½“ç¼–è¾‘æ¨¡æ€æ¡†æ ·å¼ */
        .ai-edit-modal {
            max-width: 90%;
            width: 1200px;
            max-height: 90vh;
            background-color: #f8f9fa; /* æµ…è‰²èƒŒæ™¯ */
            color: #333; /* æ·±è‰²æ–‡æœ¬ */
        }
        
        .ai-edit-content {
            padding: 20px;
            color: #333; /* æ·±è‰²æ–‡æœ¬ */
        }
        
        .ai-edit-content h4 {
            color: #333; /* æ·±è‰²æ ‡é¢˜ */
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .ai-edit-content p {
            color: #666; /* ç¨æµ…çš„æ·±è‰²æ–‡æœ¬ */
        }
        
        .ai-edit-label {
            display: block;
            margin-bottom: 8px;
            color: #333; /* æ·±è‰²æ ‡ç­¾ */
            font-weight: 600;
        }
        
        .ai-edit-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd; /* æµ…è‰²è¾¹æ¡† */
            border-radius: 6px;
            background-color: #fff; /* ç™½è‰²èƒŒæ™¯ */
            color: #333; /* æ·±è‰²æ–‡æœ¬ */
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .ai-edit-textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .ai-edit-actions {
            text-align: right;
            margin-bottom: 20px;
        }
        
        .ai-edit-loading {
            text-align: center;
            padding: 40px 20px;
            color: #666; /* æ·±è‰²åŠ è½½æ–‡æœ¬ */
        }
        
        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .code-section h5 {
            color: #333; /* æ·±è‰²æ ‡é¢˜ */
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .code-preview {
            background-color: #f8f9fa; /* æµ…è‰²èƒŒæ™¯ */
            border: 1px solid #ddd; /* æµ…è‰²è¾¹æ¡† */
            border-radius: 6px;
            padding: 15px;
            color: #333; /* æ·±è‰²ä»£ç æ–‡æœ¬ */
            font-family: 'Courier New', Monaco, monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .ai-edit-result-actions {
            text-align: center;
            margin-top: 20px;
        }
        
        .ai-edit-result-actions .btn {
            margin: 0 5px;
        }
        
        /* æ™ºèƒ½ä½“ç¼–è¾‘æ¨¡æ€æ¡†çš„å…³é—­æŒ‰é’®æ ·å¼ */
        .ai-edit-modal .close-btn {
            color: #666; /* æ·±è‰²å…³é—­æŒ‰é’® */
            background: transparent;
        }
        
        .ai-edit-modal .close-btn:hover {
            background: #e9ecef; /* æµ…è‰²æ‚¬åœèƒŒæ™¯ */
            color: #333; /* æ·±è‰²æ‚¬åœæ–‡æœ¬ */
        }
        
        /* ç¡®ä¿æ¨¡æ€æ¡†æ ‡é¢˜ä¹Ÿæ˜¯æ·±è‰² */
        .ai-edit-modal .modal-title {
            color: #333;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="top-navbar">
        <div class="navbar-brand">
            <img src="{{ url_for('static', filename='template_images/SAI-icon.png') }}" alt="SAI Logo" class="brand-logo">
            <img src="{{ url_for('static', filename='assets/logo_test.png') }}" alt="Logo" class="brand-logo">
            <div class="logo-text">EDUPAL</div>
        </div>
        <div class="navbar-right">
            <a href="#" class="nav-link active">é¦–é¡µ</a>
            <a href="https://qianc62.github.io/" class="nav-link" target="_blank">è”ç³»æˆ‘ä»¬</a>
        </div>
    </nav>

    <!-- é¡¶éƒ¨æ§åˆ¶æŒ‰é’® -->
    <div class="top-controls">
        <button class="control-btn" onclick="toggleSidebar()" title="åˆ‡æ¢å†…å®¹åˆ—è¡¨" id="sidebarToggle">â€¹</button>
    </div>

    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <header class="page-header">
            <h1 class="main-title">EDUPAL</h1>
            <p class="main-subtitle">AIé©±åŠ¨çš„æ•™å­¦æ™ºèƒ½ä½“</p>
        </header>

        <!-- æœ€ç»ˆè§†é¢‘æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="final-video-container hidden" id="finalVideoContainer">
            <div class="final-video-card">
                <div class="video-header">
                    <h3 class="video-title">ğŸ¬ æ•™å­¦è§†é¢‘ç”Ÿæˆå®Œæˆ</h3>
                    <button class="close-btn" onclick="hideFinalVideo()">Ã—</button>
                </div>
                <div class="video-content">
                    <div class="video-player-wrapper">
                        <video class="final-video-player" id="finalVideoPlayer" controls>
                            <source id="finalVideoSource" src="" type="video/mp4">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                        </video>
                    </div>
                    <div class="video-info">
                        <div class="video-meta">
                            <div class="video-filename" id="finalVideoFilename">è§†é¢‘æ–‡ä»¶å</div>
                            <div class="video-stats" id="finalVideoStats">æ–‡ä»¶å¤§å°: --</div>
                        </div>
                        <div class="video-actions">
                            <button class="btn btn-primary btn-large" id="downloadVideoBtn">
                                <span class="button-icon">ğŸ“¥</span>
                                <span class="button-text">ä¸‹è½½æ•™å­¦è§†é¢‘</span><!-- ã€æ–°å¢/ä¿®æ”¹ã€‘ -->
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- æœç´¢é¢æ¿ -->
            <div class="content-card">
                <section class="search-section">
                    <!-- æ–°å¼æœç´¢è¾“å…¥æ¡† -->
                    <div class="modern-search-container">
                        <div class="search-input-wrapper">
                            <!-- å·¦ä¾§åŠŸèƒ½æŒ‰é’® -->
                            <div class="search-function-menu">
                                <button class="function-toggle-btn" id="functionToggle">
                                    <span class="function-icon">+</span>
                                </button>
                            </div>
                            
                            <!-- æœç´¢è¾“å…¥æ¡† -->
                            <input type="text" class="modern-search-input" placeholder="è¯·æè¿°æ‚¨çš„å­¦ä¹ éœ€æ±‚ï¼ŒAIæ•™ä¼´å°†å¸®æ‚¨æ™ºèƒ½æœç´¢" id="searchInput">
                            <input type="file" id="pdfFileInput" accept=".pdf" style="display: none;" onchange="handlePdfUpload(event)">
                            <!-- ã€æ–°å¢ã€‘è¿™æ˜¯æ–‡ä»¶å¤¹è¾“å…¥æ¡† -->
                            <input type="file" id="folderInput" webkitdirectory multiple style="display: none;" onchange="handleFolderUpload(event)">

                            <!-- å³ä¾§æœç´¢æŒ‰é’® -->
                            <div class="search-actions">
                                <button class="action-btn search-btn" id="searchBtn">
                                    <span class="action-icon">â†’</span>
                                </button>
                            </div>
                        </div>

                        <!-- ä¸‹æ‹‰èœå•ç§»åˆ°è¿™é‡Œ -->
                        <div class="function-dropdown" id="functionDropdown">
                            <div class="function-option active" data-type="web">
                                <span class="option-icon">ğŸŒ</span>
                                <span class="option-text">ç½‘é¡µæœç´¢</span>
                            </div>
                            <div class="function-option" data-type="paper">
                                <span class="option-icon">ğŸ“„</span>
                                <span class="option-text">è®ºæ–‡æœç´¢</span>
                            </div>
                            <!-- <div class="function-option" onclick="switchToUploadMode()">
                                <span class="option-icon">ğŸ“</span>
                                <span class="option-text">ä¸Šä¼ å•ç¯‡PDF</span>
                            </div> -->
                            <!-- ã€æ–°å¢ã€‘ä¸Šä¼ æ–‡ä»¶å¤¹çš„é€‰é¡¹ -->
                            <!-- <div class="function-option" onclick="switchToFolderUploadMode()">
                                <span class="option-icon">ğŸ“</span>
                                <span class="option-text">ä¸Šä¼ è®ºæ–‡é›†</span>  æˆ–è€…å«â€œä¸Šä¼ æ–‡ä»¶å¤¹â€ -->
                            <!-- </div>  -->
                            <div class="function-option" onclick="setUploadMode('single')">
                                <span class="option-icon">ğŸ“</span>
                                <span class="option-text">ä¸Šä¼ å•ç¯‡PDF</span>
                            </div>
                            
                            <!-- ä¸Šä¼ è®ºæ–‡é›†é€‰é¡¹ä¹Ÿè°ƒç”¨æ–°çš„æ¨¡å¼åˆ‡æ¢å‡½æ•° -->
                            <div class="function-option" onclick="setUploadMode('folder')">
                                <span class="option-icon">ğŸ“</span>
                                <span class="option-text">ä¸Šä¼ è®ºæ–‡é›†</span>
                            </div>
                        </div>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="loading hidden" id="loading">æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚</div>
                    
                    <!-- ä¸Šä¼ æˆåŠŸåçš„å¤„ç†æŒ‰é’® -->
                    <div class="upload-success-actions hidden" id="uploadSuccessActions">
                        <div class="upload-success-info">
                            <div class="success-icon">âœ…</div>
                            <div class="success-message">
                                <div class="success-title">PDFä¸Šä¼ æˆåŠŸï¼</div>
                                <div class="success-filename" id="successFilename"></div>
                            </div>
                        </div>
                        
                        <!-- æ€»ä½“è¿›åº¦æ¡å’Œæ­¥éª¤å¯è§†åŒ–è¢«ç§»é™¤ï¼Œåœ¨ç‚¹å‡»å¼€å§‹å¤„ç†åæ˜¾ç¤º -->
                        
                        <!-- å¤„ç†è®¾ç½®é€‰é¡¹ -->
                        <div class="processing-settings">
                            <!-- åªä¿ç•™è¾“å‡ºæ ¼å¼ -->
                            <div class="setting-group">
                                <label class="setting-label">è¾“å‡ºæ ¼å¼</label>
                                <select class="setting-select" id="outputFormatSelect">
                                    <option value="video" selected>è§†é¢‘ (Video)</option>
                                    <option value="ppt">å¹»ç¯ç‰‡ (PPT)</option>
                                    <option value="markdown">æ–‡æ¡£ (Markdown)</option>
                                </select>
                            </div>
                        </div>
                        <!-- ã€æ–°å¢ã€‘ä¸€ä¸ªç”¨äºæ”¾ç½®è§†é¢‘ä¸“å±è®¾ç½®æŒ‰é’®çš„å®¹å™¨ï¼Œé»˜è®¤éšè— -->
                        <div id="videoSettingsContainer">
                            <button class="btn btn-secondary" id="openVideoSettingsBtn">
                                <!-- <span class="button-icon"></span> -->
                                ä¸ªæ€§åŒ–è®¾ç½®
                            </button>
                        </div>  

                        <button class="btn btn-primary btn-large start-processing-btn" id="startProcessingBtn">
                            <span class="button-icon">ğŸš€</span>
                            å¼€å§‹å¤„ç†
                        </button>
                    </div>
                </section>

                <!-- AIåˆ†æç»“æœ -->
                <div class="analysis-card hidden" id="analysisCard">
                    <h3 class="card-title">æ•™ä¼´AIåˆ†æç»“æœ</h3>
                    <div class="analysis-item">
                        <label class="analysis-label">æç‚¼çš„å…³é”®è¯</label>
                        <div class="analysis-value" id="extractedKeyword"></div>
                    </div>
                    <div class="analysis-item">
                        <label class="analysis-label">åˆ†æç†ç”±</label>
                        <div class="analysis-text" id="analysisReasoning"></div>
                    </div>
                    <div class="analysis-item">
                        <label class="analysis-label">æœç´¢æ„å›¾</label>
                        <div class="analysis-text" id="searchIntent"></div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="confirmSearchBtn">ç¡®è®¤æœç´¢</button>
                        <button class="btn btn-secondary" id="modifyKeywordBtn">ä¿®æ”¹å…³é”®è¯</button>
                        <button class="btn btn-outline" id="cancelAnalysisBtn">é‡æ–°è¾“å…¥</button>
                    </div>
                </div>

                <!-- æœç´¢ç»“æœ -->
                <div class="results-card hidden" id="resultsCard">
                    <div class="results-header">
                        <div class="results-header-info">
                            <h3 class="card-title" id="resultsTitle">æœç´¢ç»“æœ</h3>
                            <div class="results-meta" id="resultsMeta"></div>
                        </div>
                        <div class="results-header-actions">
                            <button class="btn btn-secondary" id="smartFilterBtn" onclick="performSmartFilter()">æ™ºèƒ½ç­›é€‰</button>
                        </div>
                    </div>
                    <div id="resultsContainer"></div>
                    
                    <!-- æ§åˆ¶æ  -->
                    <div class="controls-bar" id="controlsBar" style="display: none;">
                        <div class="selection-info">
                            å·²é€‰æ‹© <span id="selectedCount">0</span> é¡¹
                        </div>
                        <div class="control-actions">
                            <button class="btn btn-primary" id="crawlBtn" onclick="crawlSelected()">å¼€å§‹æ”¶é›†</button>
                        </div>
                    </div>

                    <!-- æ™ºèƒ½ç­›é€‰ç»“æœ -->
                    <div class="filter-result hidden" id="filterResult">
                        <h4 style="margin-bottom: 12px; color: white; font-weight: 600;">æ•™ä¼´æ™ºèƒ½ç­›é€‰æ¨è</h4>
                        <div class="filter-reasoning" id="filterReasoning"></div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="confirmFilterBtn">ç¡®è®¤æ¨è</button>
                            <button class="btn btn-outline" id="cancelFilterBtn">å–æ¶ˆç­›é€‰</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¤„ç†çŠ¶æ€å±•ç¤ºåŒºåŸŸ -->
            <div class="content-card processing-status-card hidden" id="processingStatusCard">
                <div class="processing-status-header">
                    <h3 class="card-title">è®ºæ–‡å¤„ç†è¿›åº¦</h3>
                    <button class="minimize-btn" onclick="minimizeProcessingStatus()" title="æœ€å°åŒ–">âˆ’</button>
                </div>
                
                <div class="processing-status-content" id="processingStatusContent">
                    <!-- æ€»ä½“è¿›åº¦æ¡ - ä»ä¸Šæ–¹ç§»åŠ¨åˆ°è¿™é‡Œ -->
                    <div class="overall-progress">
                        <div class="progress-header">
                            <div class="progress-title">è¯¥æ­¥éª¤è¿›åº¦</div>
                            <div style="display: flex; align-items: center;">
                                <div class="progress-percentage" id="progressPercentage">0%</div>
                                <button class="btn btn-outline btn-sm" onclick="cancelProcessing()" id="cancelBtn" style="margin-left: 10px; padding: 2px 8px; font-size: 12px;">å–æ¶ˆ</button>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤å¯è§†åŒ– - ä»ä¸Šæ–¹ç§»åŠ¨åˆ°è¿™é‡Œ -->
                    <div class="steps-container">
                        <div class="step-item" data-step="1">
                            <div class="step-icon">ğŸ“„</div>
                            <div class="step-text">è®ºæ–‡è§£æè€…</div>
                        </div>
                        <div class="step-item" data-step="2">
                            <div class="step-icon">ğŸ¬</div>
                            <div class="step-text">å†…å®¹ç”Ÿæˆå‘˜</div>
                        </div>
                        <div class="step-item" data-step="3">
                            <div class="step-icon">ğŸ“</div>
                            <div class="step-text">äº¤äº’ç¼–è¾‘è€…</div>
                        </div>
                        <div class="step-item" data-step="4">
                            <div class="step-icon">ğŸ¥</div>
                            <div class="step-text">è§†é¢‘é¢„è§ˆå‘˜</div>
                        </div>
                        <div class="step-item" data-step="5">
                            <div class="step-icon">ğŸ’¬</div>
                            <div class="step-text">åé¦ˆç¼–è¾‘è€…</div>
                        </div>
                        <div class="step-item" data-step="6">
                            <div class="step-icon">ğŸµ</div>
                            <div class="step-text">è¯­éŸ³åˆæˆå‘˜</div>
                        </div>
                        <div class="step-item" data-step="7">
                            <div class="step-icon">ğŸ”„</div>
                            <div class="step-text">éŸ³è§†é¢‘å¯¹é½è€…</div>
                        </div>
                        <div class="step-item" data-step="8">
                            <div class="step-icon">ğŸ¬</div>
                            <div class="step-text">è§†é¢‘æ¸²æŸ“å‘˜</div>
                        </div>
                        <div class="step-item" data-step="9">
                            <div class="step-icon">ğŸ¦</div>
                            <div class="step-text">æœ€ç»ˆåˆå¹¶è€…</div>
                        </div>
                    </div>
                    
                    <!-- å¤„ç†ä¸­çš„ä»»åŠ¡åˆ—è¡¨ -->
                    <div class="active-processing" id="activeProcessing">
                        <!-- åŠ¨æ€å†…å®¹ -->
                    </div>
                    
                    <!-- å¤§å‹è§†é¢‘é¢„è§ˆæŒ‰é’® -->
                    <div class="preview-button-container hidden" id="previewButtonContainer">
                        <button class="btn btn-large btn-primary" id="enterPreviewBtn" onclick="openVideoPreview()">
                            <span class="button-icon">ğŸ¬</span>
                            è¿›å…¥è§†é¢‘é¢„è§ˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Webç‰ˆäº¤äº’ç¼–è¾‘å™¨ -->
            <div class="content-card editor-card hidden" id="editorCard">
                <div class="editor-header">
                    <h3 class="card-title">ğŸ“ äº¤äº’å¼æ–‡ä»¶ç¼–è¾‘å™¨</h3>
                    <div class="editor-controls">
                        <button class="btn btn-secondary" id="refreshFilesBtn" onclick="refreshEditorFiles()">åˆ·æ–°æ–‡ä»¶</button>
                        <button class="btn btn-outline" id="closeEditorBtn" onclick="closeEditor()">å…³é—­ç¼–è¾‘å™¨</button>
                    </div>
                </div>
                
                <div class="editor-content">
                    <!-- å·¦ä¾§æ–‡ä»¶åˆ—è¡¨ -->
                    <div class="editor-sidebar">
                        <div class="sidebar-header">
                            <h4>ğŸ“ æ–‡ä»¶ç®¡ç†</h4>
                            <div class="file-search">
                                <input type="text" id="fileSearchInput" placeholder="æœç´¢æ–‡ä»¶..." onkeyup="searchEditorFiles()">
                            </div>
                        </div>
                        
                        <!-- Codeæ–‡ä»¶åˆ†ç»„ -->
                        <div class="file-group">
                            <div class="group-header">
                                <div class="group-title">
                                    <span class="group-icon">ğŸ</span>
                                    <span class="group-name">Pythonä»£ç </span>
                                    <span class="group-count" id="codeFileCount">0</span>
                                </div>
                                <button class="group-toggle" id="codeToggle" onclick="toggleFileGroup('code')">
                                    <span>âˆ’</span>
                                </button>
                            </div>
                            <div class="file-list" id="codeFileList">
                                <!-- Codeæ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <!-- Speechæ–‡ä»¶åˆ†ç»„ -->
                        <div class="file-group">
                            <div class="group-header">
                                <div class="group-title">
                                    <span class="group-icon">ğŸ“</span>
                                    <span class="group-name">è®²ç¨¿æ–‡æœ¬</span>
                                    <span class="group-count" id="speechFileCount">0</span>
                                </div>
                                <button class="group-toggle" id="speechToggle" onclick="toggleFileGroup('speech')">
                                    <span>âˆ’</span>
                                </button>
                            </div>
                            <div class="file-list" id="speechFileList">
                                <!-- Speechæ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <!-- Video Previewæ–‡ä»¶åˆ†ç»„ -->
                        <div class="file-group">
                            <div class="group-header">
                                <div class="group-title">
                                    <span class="group-icon">ğŸ¬</span>
                                    <span class="group-name">è§†é¢‘é¢„è§ˆ</span>
                                    <span class="group-count" id="videoFileCount">0</span>
                                </div>
                                <button class="group-toggle" id="videoToggle" onclick="toggleFileGroup('video')">
                                    <span>âˆ’</span>
                                </button>
                            </div>
                            <div class="file-list" id="videoFileList">
                                <!-- Videoæ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <!-- èƒŒæ™¯å›¾ä¸Šä¼ åŒºåŸŸ -->
                        <div class="background-upload">
                            <h5>ğŸ–¼ï¸ èƒŒæ™¯å›¾è®¾ç½®</h5>
                            <div class="upload-area">
                                <input type="file" id="backgroundFileInput" accept="image/*" style="display: none;" onchange="handleBackgroundUpload(event)">
                                <button class="btn btn-outline upload-btn" onclick="document.getElementById('backgroundFileInput').click()">
                                    é€‰æ‹©èƒŒæ™¯å›¾
                                </button>
                                <div class="upload-info" id="backgroundUploadInfo"></div>
                                <button class="btn btn-primary apply-bg-btn hidden" id="applyBackgroundBtn" onclick="applyBackgroundToCode()">
                                    åº”ç”¨åˆ°æ‰€æœ‰ä»£ç 
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å³ä¾§ç¼–è¾‘åŒºåŸŸ -->
                    <div class="editor-main">
                        <div class="editor-tabs">
                            <div class="tab-list" id="editorTabs">
                                <!-- ç¼–è¾‘å™¨æ ‡ç­¾å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <div class="editor-workspace" id="editorWorkspace">
                            <!-- æ¬¢è¿ç•Œé¢ -->
                            <div class="welcome-screen" id="welcomeScreen">
                                <div class="welcome-content">
                                    <div class="welcome-icon">ğŸš€</div>
                                    <h3>æ¬¢è¿ä½¿ç”¨äº¤äº’å¼ç¼–è¾‘å™¨</h3>
                                    <p>é€‰æ‹©å·¦ä¾§æ–‡ä»¶åˆ—è¡¨ä¸­çš„æ–‡ä»¶å¼€å§‹ç¼–è¾‘</p>
                                    <div class="feature-list">
                                        <div class="feature-item">
                                            <span class="feature-icon">ğŸ“</span>
                                            <span>åœ¨çº¿ç¼–è¾‘Pythonä»£ç å’Œè®²ç¨¿æ–‡æœ¬</span>
                                        </div>
                                        <div class="feature-item">
                                            <span class="feature-icon">ğŸ–¼ï¸</span>
                                            <span>ä¸ºåŠ¨ç”»æ·»åŠ è‡ªå®šä¹‰èƒŒæ™¯å›¾</span>
                                        </div>
                                        <div class="feature-item">
                                            <span class="feature-icon">ğŸ’¾</span>
                                            <span>å®æ—¶ä¿å­˜ï¼Œè‡ªåŠ¨å¤‡ä»½</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ç¼–è¾‘å™¨å®¹å™¨ -->
                            <div class="editor-container hidden" id="editorContainer">
                                <div class="editor-toolbar">
                                    <div class="file-info">
                                        <span class="file-name" id="currentFileName">æœªé€‰æ‹©æ–‡ä»¶</span>
                                        <span class="file-stats" id="currentFileStats"></span>
                                    </div>
                                    <div class="editor-actions">
                                        <button class="btn btn-outline" id="undoBtn" onclick="undoChanges()" disabled>æ’¤é”€</button>
                                        <button class="btn btn-secondary" id="aiEditBtn" onclick="openAiEditDialog()" disabled>ğŸ¤– æ™ºèƒ½ä½“ç¼–è¾‘</button>
                                        <button class="btn btn-primary" id="saveBtn" onclick="saveCurrentFile()" disabled>ä¿å­˜</button>
                                    </div>
                                </div>
                                
                                <div class="code-editor">
                                    <textarea id="codeEditor" class="code-textarea" spellcheck="false"></textarea>
                                </div>
                                
                                <div class="editor-status">
                                    <div class="status-info" id="editorStatus">å°±ç»ª</div>
                                    <div class="cursor-info" id="cursorInfo">è¡Œ 1, åˆ— 1</div>
                                </div>
                            </div>
                            
                            <!-- è§†é¢‘æ’­æ”¾å™¨å®¹å™¨ -->
                            <div class="video-container hidden" id="videoContainer">
                                <div class="video-toolbar">
                                    <div class="video-info">
                                        <span class="video-name" id="currentVideoName">æœªé€‰æ‹©è§†é¢‘</span>
                                        <span class="video-stats" id="currentVideoStats"></span>
                                    </div>
                                    <div class="video-actions">
                                        <button class="btn btn-outline" id="fullscreenBtn" onclick="toggleFullscreen()">å…¨å±</button>
                                        <button class="btn btn-secondary" id="editRelatedBtn" onclick="editRelatedFiles()" disabled>ç¼–è¾‘ç›¸å…³æ–‡ä»¶</button>
                                    </div>
                                </div>
                                
                                <div class="video-player-wrapper">
                                    <video class="video-player" id="videoPlayer" controls>
                                        <source id="videoSource" src="" type="video/mp4">
                                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                                    </video>
                                </div>
                                
                                <div class="video-related-files" id="videoRelatedFiles">
                                    <h5>ç›¸å…³æ–‡ä»¶</h5>
                                    <div class="related-files-list" id="relatedFilesList">
                                        <!-- ç›¸å…³æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">å­¦ä¹ èµ„æ–™åº“</h3>
            <button class="sidebar-clear-btn" onclick="exitApplication()" title="æ¸…ç©ºæ‰€æœ‰å†…å®¹">Ã—</button>
        </div>
        <div id="contentSections">
            <!-- å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
        </div>
    </aside>

    <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
    <div class="modal-overlay hidden" id="previewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">å†…å®¹é¢„è§ˆ</h3>
                <button class="close-btn" onclick="closePreview()">Ã—</button>
            </div>
            <div class="modal-content">
                <iframe class="modal-iframe" id="previewIframe" src=""></iframe>
            </div>
        </div>
    </div>

    <!-- åé¦ˆç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div class="modal-overlay hidden" id="feedbackEditorModal">
        <div class="modal feedback-editor-modal">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ’¬ åé¦ˆç¼–è¾‘å™¨</h3>
                <div class="modal-header-actions">
                    <button class="btn btn-success" id="finishEditingBtn" onclick="finishFeedbackEditing()">
                        âœ… å®Œæˆç¼–è¾‘
                    </button>
                    <button class="close-btn" onclick="closeFeedbackEditor()">Ã—</button>
                </div>
            </div>
            <div class="modal-content">
                <div class="editor-loading" id="editorLoading">
                    <div class="loading-spinner"></div>
                    <p>æ­£åœ¨åŠ è½½åé¦ˆç¼–è¾‘å™¨...</p>
                </div>
                <iframe class="modal-iframe feedback-editor-iframe" id="feedbackEditorIframe" src=""></iframe>
            </div>
        </div>
    </div>

    <!-- æ™ºèƒ½ä½“ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal-overlay hidden" id="aiEditModal">
        <div class="modal ai-edit-modal">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ¤– æ™ºèƒ½ä½“ç¼–è¾‘å™¨</h3>
                <button class="close-btn" onclick="closeAiEditDialog()">Ã—</button>
            </div>
            <div class="modal-content">
                <div class="ai-edit-content">
                    <div class="ai-edit-request">
                        <label for="editRequestInput" class="ai-edit-label">è¯·è¾“å…¥ä½ çš„ä¿®æ”¹éœ€æ±‚ï¼š</label>
                        <textarea id="editRequestInput" class="ai-edit-textarea" placeholder="ä¾‹å¦‚ï¼šå°†èƒŒæ™¯è‰²æ”¹ä¸ºè“è‰²ï¼Œå¢åŠ æ³¨é‡Šï¼Œä¼˜åŒ–ä»£ç ç»“æ„ç­‰..." rows="4"></textarea>
                        <div class="ai-edit-actions">
                            <button class="btn btn-primary" id="submitEditBtn" onclick="submitAiEdit()">ğŸš€ å¼€å§‹ç¼–è¾‘</button>
                            <button class="btn btn-outline" onclick="closeAiEditDialog()">å–æ¶ˆ</button>
                        </div>
                    </div>
                    
                    <div class="ai-edit-loading hidden" id="aiEditLoading">
                        <div class="loading-spinner"></div>
                        <p>AIæ­£åœ¨åˆ†æå¹¶ç¼–è¾‘ä»£ç ...</p>
                    </div>
                    
                    <div class="ai-edit-result hidden" id="aiEditResult">
                        <h4>ä¿®æ”¹ç»“æœé¢„è§ˆï¼š</h4>
                        <div class="code-comparison">
                            <div class="code-section">
                                <h5>åŸå§‹ä»£ç ï¼š</h5>
                                <pre class="code-preview" id="originalCodePreview"></pre>
                            </div>
                            <div class="code-section">
                                <h5>ä¿®æ”¹åä»£ç ï¼š</h5>
                                <pre class="code-preview" id="modifiedCodePreview"></pre>
                            </div>
                        </div>
                        <div class="ai-edit-result-actions">
                            <button class="btn btn-success" id="applyChangesBtn" onclick="applyAiChanges()">âœ… åº”ç”¨ä¿®æ”¹</button>
                            <button class="btn btn-outline" onclick="discardAiChanges()">âŒ ä¸¢å¼ƒä¿®æ”¹</button>
                            <button class="btn btn-secondary" onclick="editAgain()">ğŸ”„ é‡æ–°ç¼–è¾‘</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ã€æ–°å¢ã€‘è§†é¢‘é«˜çº§è®¾ç½®æ‚¬æµ®çª— (Modal) -->
    <div class="modal-overlay hidden" id="videoSettingsModalOverlay">
        <div class="modal video-settings-modal">
            <div class="modal-header">
                <h3 class="modal-title">ç”Ÿæˆè§†é¢‘ä¸ªæ€§åŒ–è®¾ç½®</h3>
                <button class="close-btn" onclick="closeVideoSettingsModal()">Ã—</button>
            </div>
            <div class="modal-content">
                <!-- è§†é¢‘æ—¶é•¿ -->
                <div class="settings-section">
                    <h4>è§†é¢‘æ—¶é•¿</h4>
                    <div class="setting-group">
                        <select class="setting-select" id="modalVideoDurationSelect">
                            <option value="short">çŸ­è§†é¢‘ (3-5åˆ†é’Ÿ)</option>
                            <option value="medium" selected>ä¸­ç­‰ (8-12åˆ†é’Ÿ)</option>
                            <option value="long">é•¿è§†é¢‘ (15-20åˆ†é’Ÿ)</option>
                        </select>
                    </div>
                </div>

                <!-- äººå£°é€‰æ‹© -->
                <div class="settings-section">
                    <h4>äººå£°é€‰æ‹©</h4>
                    <div class="voice-options-grid">
                        <!-- é¢„è®¾äººå£° -->
                        <div class="voice-option-item selected" data-voice="female" onclick="selectVoice(this, 'female')">
                            <div class="voice-icon">ğŸ‘©</div>
                            <div class="voice-name">ä¼˜é›…å¥³å£°</div>
                            <button class="preview-audio-btn" onclick="previewVoice('zero_shot_prompt.wav', event)">â–¶</button>
                        </div>
                        <div class="voice-option-item" data-voice="male" onclick="selectVoice(this, 'male')">
                            <div class="voice-icon">ğŸ‘¨</div>
                            <div class="voice-name">ç£æ€§ç”·å£°</div>
                            <button class="preview-audio-btn" onclick="previewVoice('cross_lingual_prompt.wav', event)">â–¶</button>
                        </div>
                        <div class="voice-option-item" data-voice="child" onclick="selectVoice(this, 'child')">
                            <div class="voice-icon">ğŸ‘¦</div>
                            <div class="voice-name">é˜³å…‰ç«¥å£°</div>
                            <button class="preview-audio-btn" onclick="previewVoice('child.mp3', event)">â–¶</button>
                        </div>
                        <!-- ä¸Šä¼ äººå£° -->
                        <div class="voice-option-item upload-item" onclick="document.getElementById('voiceUploadInput').click()">
                            <div class="voice-icon">ğŸ¤</div>
                            <div class="voice-name">ä¸Šä¼ 10séŸ³è‰²</div>
                                <!-- ã€æ–°å¢ã€‘ä¸€ä¸ªä¸“é—¨ç”¨äºæ˜¾ç¤ºä¸Šä¼ ç»“æœçš„å®¹å™¨ï¼Œå¹¶ç»™å®ƒæ­£ç¡®çš„ID -->
                            <input type="file" id="voiceUploadInput" accept=".mp3,.wav" style="display: none;" onchange="handleVoiceUpload(event)">
                        </div>
                    </div>
                    <!-- <div class="uploaded-preview-area hidden" id="voiceUploadPreviewArea"> -->
                        <!-- JSä¼šåœ¨è¿™é‡Œå¡«å……å†…å®¹ -->
                    <!-- </div> -->
                    <!-- ã€ä¿®æ”¹ã€‘è¿™ä¸ªå®¹å™¨ç°åœ¨åŒ…å«ä¸¤ä¸ªéƒ¨åˆ† -->
                    <div class="upload-info" id="voiceUploadInfo">
                        <div id="voiceFileUploadInfo"></div> <!-- ç”¨äºæ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ ä¿¡æ¯å’Œæ’­æ”¾æŒ‰é’® -->
                        <div id="voiceTextInputContainer" class="hidden"></div> <!-- ç”¨äºæ˜¾ç¤ºæ–‡æœ¬è¾“å…¥æ¡†ï¼Œé»˜è®¤éšè— -->
                    </div>
                </div>

                <!-- èƒŒæ™¯é€‰æ‹© -->
                <div class="settings-section">
                    <h4>èƒŒæ™¯é€‰æ‹©</h4>
                    <div class="background-gallery">
                        <!-- é¢„è®¾èƒŒæ™¯ -->
                        <div class="background-option-item selected" onclick="selectBackground(this, 'background.png')">
                            <img src="{{ url_for('static', filename='backgrounds/background.png') }}" alt="SJTU-SAIä¸»é¢˜èƒŒæ™¯">
                        </div>
                        <div class="background-option-item" onclick="selectBackground(this, 'SJTU.png')">
                            <img src="{{ url_for('static', filename='backgrounds/SJTU.png') }}" alt="SJTUèƒŒæ™¯">
                        </div>
                        <!-- ä¸Šä¼ èƒŒæ™¯ -->
                        <div class="background-option-item upload-item" onclick="document.getElementById('backgroundUploadInput').click()">
                            <div class="upload-icon">+</div>
                            <div class="upload-text">è‡ªå®šä¹‰</div>
                             <input type="file" id="backgroundUploadInput" accept="image/*" style="display: none;" onchange="handleSettingsBackgroundUpload(event)">
                             
                        </div>
                    </div>
                     <div class="upload-info" id="backgroundUploadInfo"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveVideoSettings()">ç¡®è®¤è®¾ç½®</button>
            </div>
        </div>
    </div>
    <!-- æ‚¬æµ®çª—HTMLç»“æŸ -->

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html> 